<main class="content-main">
  <section class="content-section">
    <section class="basesection">
      <div class="basesection-header">
        <div class="sectiontitle">
          <div class="sectiontitle-caption">
            <p>体調グラフ</p>
          </div>
        </div>
      </div>
      <div class="basesection-period">
        <%= render 'layouts/to_next_or_prev_period', report: @report %>
        <%= render 'layouts/change_period', report: @report %>
      </div>
      <div class="basesection-card basesection-contents statistics">
        <canvas id="myChart" style="width:100%; height:60vh;"></canvas>
        <div class="chart-toggles">
            <a class="activity enabled">活動量</a>
            <a class="mood enabled">気分</a>
            <a class="appetite enabled">食欲</a>
        </div>
      </div>
    </section>
  </section>
</main>

<script>

var ctx = document.getElementById("myChart").getContext('2d');

var options = {
  responsive: true,
  scales: {
    yAxes: [{
      ticks: {
        max: 2,
        min: -2,
        stepSize: 1.0
      }
    }]
  }
};

var chartlabel = <%= @report.chart[:labels].to_json.html_safe %>;

var enableCheck = function() {
  ACTOn = jQuery('.activity').hasClass('enabled');
  MOOOn = jQuery('.mood').hasClass('enabled');
  APPOn = jQuery('.appetite').hasClass('enabled');
  if (!(ACTOn)) {
    ACT = {
      label: "",

    };
  } else {
    ACT = {
      label: "活動量",
      borderColor: "#ff7493",
      backgroundColor: "#ff7493",
      fill: false,
      borderWidth: 3,
      data: <%= @report.chart[:datasets][:activity].to_json.html_safe %>
    };
  };
  if (!(MOOOn)) {
    MOO = {
      label: "",
    };
  } else {
    MOO = {
      label: "気分",
      borderColor: "#00afff",
      backgroundColor: "#00afff",
      fill: false,
      borderWidth: 3,
      data: <%= @report.chart[:datasets][:mood].to_json.html_safe %>
    };
  };
  if (!(APPOn)) {
    APP = {
      label: "",
    };
  } else {
    APP = {
      label: "食欲",
      borderColor: "#ffa600",
      backgroundColor: "#ffa600",
      fill: false,
      borderWidth: 3,
      data: <%= @report.chart[:datasets][:appetite].to_json.html_safe %>
    };
  };
};

jQuery(document).ready(function() {
  enableCheck();

  data = {
    labels: chartlabel,
    datasets: [ ACT, MOO, APP ]
  };

  baseChart = new Chart(ctx , {
    type: 'line',
    data: data,
    options: options
  });
  currentChart = baseChart;
});

jQuery('.chart-toggles a').click(function() {
  jQuery(this).toggleClass('enabled');
  enableCheck();
  data = {
    labels: chartlabel,
    datasets: [ ACT, MOO, APP ]
  };

  currentChart.data = data;
  currentChart.options = options;
  currentChart.update();
})
</script>
